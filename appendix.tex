\section{Variational principle}\label{var_prin}

Here we consider the more general equation of state for the gas with
$P = K \rhog^{\Gamma}$ where $K$ is a prescribed function of position
and $\Gamma$ is a constant. The effective energy equation is then
Eq. \ref{poly_energy}. We also include the self-gravitational
potential $\psi$ of the gas
plus dust mixture, which satisfies 
%\begin{align}
$  \nabla^2 \psi  = 4 \pi G \rho. $
%\end{align} 
The linearized equations for axisymmetric
disturbances are  

\begin{align}
  \ii\sigma\frac{\delta\rho}{\rho} &= \nabla\cdot\dd\bm{v} +
  \dd\bm{v}\cdot\nabla\ln{\rho},\label{lin_mass_full}\\
%  \ii\sigma\frac{\delta P}{P} &= \nabla\cdot\dd\bm{v} +
   \ii\sigma\frac{\delta P}{P} &= \Gamma \nabla\cdot\dd\bm{v} +
  \dd\bm{v}\cdot\nabla\ln{P} - \dd\bm{v}\cdot\nabla\ln{c_s^2} - \frac{\dd\mathcal{C}}{P}.\label{lin_energy_full}\\
  -\ii\sigma\dd v_r  &= 2\Omega\dd v_\phi + 
  \hat{\bm{r}} \cdot \delta\bm{F} -  \hat{\bm{r}} \cdot \nabla\dd\psi ,\\
  \ii\sigma\dd v_\phi &= \frac{\kappa^2}{2\Omega}\dd v_r + \frac{\p
    v_\phi}{\p z}\dd v_z,\\
  -\ii\sigma\dd v_z &=  \hat{\bm{z}} \cdot \delta\bm{F}  -  \hat{\bm{z}} \cdot \nabla\dd\psi, \\ 
\nabla^2 \delta\psi & = 4\pi G \dd\rho. 
\end{align}  
where the linearizd pressure force $\delta \bm{F}$ is given in
Appendix \ref{lin_press}. These equations do not assume the
radially-local approximation used in the main text. From the
linearized meridional momentum equations, we find  

\begin{align}
  \sigma^2\int\rho\left(|\dd v_r|^2 + |\dd v_z|^2\right)dV = \int\left( \rho
  \kappa^2 |\dd v_r|^2 + \rho r\frac{\p \Omega^2}{\p z} \dd v_z \dd
  v_r^*  + \ii\sigma \rho \dd \bm{F}\cdot\dd\bm{v}^*
  - \ii \sigma \rho \nabla\dd\psi\cdot  \dd\bm{v}^* 
  \right)dV,\label{meridional}
\end{align}
where the integral is taken over the volume of the fluid. Integrating
by parts and ignoring surface integrals, the last term is
\begin{align}
  \int \ii\sigma\rho \dd \bm{F}\cdot\dd\bm{v}^*dV &=\int\left( \ii\sigma \frac{\dd
    \rho}{\rho}\dd\bm{v}^*\cdot \nabla P - \ii\sigma \dd
  \bm{v}^*\cdot\nabla \dd P  \right)dV\notag\\
&= \int\left( \ii\sigma \frac{\dd
    \rho}{\rho}\dd\bm{v}^*\cdot\nabla P + \ii\sigma \dd
 P  \nabla\cdot \dd \bm{v}^*  \right)dV\notag\\
 & = \int\left[
%   \left(
%   \ii\sigma \frac{\dd P}{P} - \dd\bm{v}\cdot\nabla s + \dd
%   \bm{v} \cdot \nabla \ln{c_s^2} + \frac{\dd\mathcal{C}}{P}
%   \right)\dd\bm{v}^*\cdot\nabla P  
   \left(
   \ii\sigma \frac{\dd P}{\Gamma P} - \dd\bm{v}\cdot\nabla \seff + \frac{\dd
   \bm{v}}{\Gamma} \cdot \nabla \ln{K} +
   \frac{\dd\mathcal{C}}{\Gamma P} \right)\dd\bm{v}^*\cdot\nabla P
   + \ii\sigma \dd P  \nabla\cdot \dd \bm{v}^*
   \right]dV\notag\\
 & = \int\left[
%   \ii\sigma\frac{\dd P}{P}\nabla\cdot\left(P\dd\bm{v}^*\right) +
%   \left(\dd\bm{v}^*\cdot\nabla P\right) \left(\dd\bm{v} \cdot \nabla
%   \ln{c_s^2} + \frac{\dd\mathcal{C}}{P}   -  \dd\bm{v}\cdot\nabla s\right) 
%   \right]dV\notag\\
   \ii\sigma\frac{\dd P}{\Gamma P}\left(\dd\bm{v}^*\cdot\nabla P +
   \Gamma P\nabla\cdot\dd\bm{v}^*   \right)
   +\left(\dd\bm{v}^*\cdot\nabla P\right) \left( \frac{\dd\bm{v}}{\Gamma} \cdot \nabla
   \ln{K} + \frac{\dd\mathcal{C}}{\Gamma P}   -  \dd\bm{v}\cdot\nabla \seff\right) 
   \right]dV\notag\\
 & = \int\left\{
%   \left[\frac{1}{P}\nabla\cdot\left(P\dd\bm{v}\right) -
%   \dd\bm{v}\cdot\nabla\ln{c_s^2} - \frac{\dd\mathcal{C}}{P}  \right]\nabla\cdot\left(P\dd\bm{v}^*\right)
%   +\left(\dd\bm{v}^*\cdot\nabla P\right)\left(\dd\bm{v} \cdot \nabla
%   \ln{c_s^2} + \frac{\dd\mathcal{C}}{P}   -  \dd\bm{v}\cdot\nabla s \right)
%   \right\}dV \notag\\
 \left[
   \nabla\cdot\dd\bm{v} +
  \frac{\dd\bm{v}}{\Gamma}\cdot\nabla\ln{P} -
  \frac{\dd\bm{v}}{\Gamma}\cdot\nabla\ln{K} -
  \frac{\dd\mathcal{C}}{\Gamma P}. 
  \right]
 \left(\dd \bm{v}^*\cdot\nabla P +
 \Gamma P\nabla\cdot\dd\bm{v}^*   \right)\right. \notag\\
 &\phantom{=\int\left\{\right\}}\left. 
 + \left(\dd\bm{v}^*\cdot\nabla P\right)\left(\frac{\dd\bm{v}}{\Gamma} \cdot \nabla
 \ln{K}
 + \frac{\dd\mathcal{C}}{\Gamma P}   -  \dd\bm{v}\cdot\nabla \seff \right)
 \right\}dV \notag\\
 &=\int\left[
%     \frac{1}{P}\left|\nabla\cdot\left(P\dd\bm{v}\right)\right|^2 -
%     \left(\dd\bm{v}^*\cdot\nabla P\right)\left(\dd\bm{v}\cdot\nabla s
%     \right) -
%     P\left(\nabla\cdot\dd\bm{v}^*\right)\left(\dd\bm{v}\cdot\nabla\ln{c_s^2} + \frac{\dd\mathcal{C}}{P} \right)  
    \frac{1}{\Gamma P} \Bigl\lvert \dd \bm{v}\cdot\nabla P +
 \Gamma P\nabla\cdot\dd \bm{v}    \Bigr\rvert ^2 - 
     \left(\dd\bm{v}^*\cdot\nabla P\right)\left(\dd\bm{v}\cdot\nabla \seff
     \right) -
      P\left(\nabla\cdot\dd\bm{v}^*\right)\left(\dd\bm{v}\cdot\nabla\ln{K} + \frac{\dd\mathcal{C}}{P} \right) 
     \right]dV,
\end{align}
where  $\seff\equiv\ln{(P^{1/\Gamma}/\rho)}$. 
The self-gravitational part of Eq. \ref{meridional} is, again
nelgecting surface terms when integrating by parts, 
\begin{align}
-\int \ii\sigma \rho \nabla\dd\psi \cdot\dd  \bm{v}^* &= \int \ii\sigma
  \dd\psi \nabla\cdot\left(\rho\dd\bm{v}^*\right) dV
 = \int \left|\sigma\right|^2 \dd\psi \dd \rho^*dV 
  = -\frac{1}{4\pi G}\int   \left|\sigma\right|^2
   \left|\nabla\psi\right|^2 dV,  
\end{align}
where the linearized continuity and Poisson equations have been used. 

Hence,
\begin{align}\label{integral_ex}
  &\sigma^2\int\rho\left(|\dd v_r|^2 + |\dd v_z|^2\right)dV \notag\\
&=  \int\left\{
  \rho |\dd v_r|^2 \left(\kappa^2 - \frac{1}{\rho}\frac{\p P}{\p
    r}\frac{\p \seff}{\p r}\right)
  + \rho |\dd v_z|^2\left(-\frac{1}{\rho}\frac{\p P}{\p
    z}\frac{\p \seff}{\p z}\right)
   + \rho \dd v_z \dd v_r^*\left(r\frac{\p\Omega^2}{\p z} -
  \frac{1}{\rho}\frac{\p P}{\p
    r}\frac{\p \seff}{\p z}\right) 
  + \rho \dd v_z^*\dd v_r \left(-\frac{1}{\rho}\frac{\p P}{\p
    z}\frac{\p \seff}{\p r}\right)\right. \notag\\
&\phantom{==\int}\left.+
%  \frac{1}{P}\left|\nabla\cdot\left(P\dd\bm{v}\right)\right|^2
 \frac{1}{\Gamma P}\Bigl\lvert \dd\bm{v}\cdot\nabla P +
 \Gamma P\nabla\cdot\dd\bm{v}     \Bigr\rvert^2
 - \frac{1}{4\pi G}\left|\sigma\nabla\dd\psi\right|^2 
  \right\}dV 
%  P\left(\nabla\cdot\dd\bm{v}^*\right)\left(\dd\bm{v}\cdot\nabla\ln{c_s^2}\right)dV
-\int    P\left(\nabla\cdot\dd\bm{v}^*\right)\left(\dd\bm{v}\cdot\nabla\ln{K}\right)dV
  -\int \left(\nabla\cdot\dd\bm{v}^*\right)\dd\mathcal{C}dV.  
\end{align}
Note that the coefficient of $\delta v_z\delta v_r^*$ and $\delta
v_z^*\delta v_r$ are equal owing to the equilibrium state
(Eq. \ref{vshear}). The non-self-gravitating case with $\Gamma=1,\, K = c_s^2$ gives
Eq. \ref{int_rel}. Similar integral relations are given by 
\cite{kato78, kley93,latter06}.  

%If $c_s$ is constant then the second integral vanishes, $\sigma^2$
%is real, and the first integral leads to the usual Solberg-Hoiland
%criteria. However, for a stationary but non-uniform temperature
%profile, the second  

\section{Linearized pressure forces and its divergence}\label{lin_press}
%Define
%\begin{align}
 % \bm{F} \equiv - \frac{\nabla P}{\rho}. 
%\end{align}
The linearized form of the pressure force $\bm{F} = -\nabla P/\rho$ is  
\begin{align}
  \delta \bm{F} = - \frac{\dd\rho}{\rho}\bm{F} -
  \frac{1}{\rho}\nabla\dd P,
\end{align}
with divergence
\begin{align}
  \nabla\cdot\dd\bm{F} = -
  \nabla\left(\frac{\dd\rho}{\rho}\right)\cdot\bm{F} -
  \frac{\dd\rho}{\rho}\nabla\cdot\bm{F} +
  \nabla\ln{\rho}\cdot\frac{\nabla\dd P}{\rho} -
  \frac{1}{\rho}\nabla^2\dd P. 
\end{align}

%\subsection{Explicit expressions}

The explicit forms for $\dd\bm{F}$ and $\nabla\cdot\dd\bm{F}$, in the
radially-local approximation, are
\begin{align}
  &\dd F_r = - W F_r - \ii k Q,\\
  &\dd F_z = - W F_z - \left[Q^\prime + Q
    \left(\ln{\rho}\right)^\prime\right]  = - \ii\sigma \dd v_z, 
\end{align} 
where the last equality is the linearized
vertical momentum equation; and 
\begin{align}
  \nabla\cdot\dd\bm{F} &= F_r\left(\p_r\ln{\rho} - \ii k \right)W - F_z
  W^\prime - W \nabla\cdot\bm{F} + \ii kQ \p_r\ln{\rho} +
  \left(\ln{\rho}\right)^\prime\left[Q^\prime + Q
    \left(\ln{\rho}\right)^\prime\right] \notag\\
  & \phantom{=} + k^2 Q - \left\{Q^{\prime\prime} + 2
    Q^\prime\left(\ln{\rho}\right)^\prime
    + Q\left[\left(\ln{\rho}\right)^{\prime\prime}+\left(\ln{\rho}\right)^{\prime
      2}\right]\right\}\notag\\
    &= \left[\left(\p_r\ln{\rho}-\ii k\right)F_r - \nabla\cdot\bm{F} +
      F_z^\prime\right]W + \left(\ii k \p_r\ln{\rho} + k^2\right)Q  -
      \ii\sigma \dd v_z^\prime.
\end{align}




\section{Linearized dust diffusion}\label{lin_dust}
We consider small grains in the Epstein regime, with fixed internal
density and size, so that
\begin{align}
  \tstop  =  \frac{K}{\rho c_s}
\end{align}
\citep{price15}, where $K$ is a constant. Then the dust diffusion
function becomes
\begin{align}
  \mathcal{C} \equiv c_s^2\nabla\cdot\left(\tepsilon\tstop\nabla
  P\right) = - K c_s^2 \nabla\cdot
  \left(\frac{\tepsilon}{c_s}\bm{F}\right) =
  -Kc_s \left(\bm{F}\cdot\nabla\tepsilon + \tepsilon \nabla\cdot\bm{F}
  - \frac{1}{2}\tepsilon\bm{F}\cdot\nabla\ln{c_s^2}\right).  
\end{align}
Linearizing,
\begin{align}
  - \frac{\dd\mathcal{C}}{Kc_s} = \bm{F}\cdot\nabla\dd\tepsilon +
  \dd\bm{F}\cdot\nabla\tepsilon + \dd\tepsilon\nabla\cdot\bm{F} +
  \tepsilon\nabla\cdot\dd\bm{F} -
  \frac{1}{2}\nabla\ln{c_s^2}\cdot\left(\bm{F}\dd\tepsilon + \tepsilon
  \dd\bm{F}\right). 
\end{align}
The linearized dust-fraction $\dd\tepsilon$ and its derivatives in the
radially-local approximation are given by
\begin{align}
  \dd\tepsilon      &= (1-\tepsilon)W - \frac{Q}{c_s^2}, \\
  \p_r\dd\tepsilon &= \left[(1-\tepsilon)\left(\ii k -
    \p_r\ln{\rho}\right) - \p_r\tepsilon\right]W + \left(\p_r\ln{c_s^2}
  + \p_r\ln{\rho} - \ii k \right)\frac{Q}{c_s^2},\\
  \dd\tepsilon^\prime &= (1-\tepsilon)W^\prime - \tepsilon^\prime W -
  \left(\frac{Q}{c_s^2}\right)^\prime. 
\end{align}

%\section{Conversion formulae}
%The gas density $\rhog$ and dust-to-gas ratio $\epsilon$ is related
%to the total density $\rho$ and dust-fraction $\tepsilon$ by
%\begin{align}
%  \ln{\rho} &= \ln{\rhog} + \ln{\left(1 + \epsilon\right)},\\
%  \nabla\ln{\rho} &= \nabla\ln{\rhog} + \frac{\nabla\epsilon}{1+
%    \epsilon},\\
%  \nabla^2\ln{\rho} &= \nabla^2\ln{\rhog} +
%  \frac{\nabla^2\epsilon}{1+\epsilon} -
%  \frac{\left|\nabla\epsilon\right|^2}{\left(1+\epsilon\right)^2}, 
%\end{align}
%and
%\begin{align}
%  \tepsilon &= \frac{\epsilon}{1+ \epsilon},\\
% \nabla\tepsilon & =
% \frac{\nabla\epsilon}{\left(1+\epsilon\right)^2},\\
% \nabla^2\tepsilon &=
% \frac{\nabla^2\epsilon}{\left(1+\epsilon\right)^2} -
% \frac{2\left|\nabla\epsilon\right|^2}{\left(1+\epsilon\right)^3}. 
%\end{align}

\section{Dispersion relation in an unstratified isothermal dusty disk}\label{compressible_streaming}
We consider an unstratified disk with $\Phi = \Phi (r)$ so that $\p_zP = \p_z\rho =
0$. The background $\p_rP/\rho$ and $\tepsilon$ are constants. 
We Fourier analyze in $r$ and $z$ so that $\p_z\to \ii k_z$ and
$\p_r\to \ii k_x$ when acting on perturbations, and denote $|\bm{k}|^2
\equiv k_x^2 + k_z^2$. We neglect 
background gradients when compared with that of perturbations. The linearized
equations are, after eliminating the azimuthal velocity: 

\begin{align}
  \ii \sigma W &=\nabla\cdot \bm{\dd v} = \ii k_x \dd v_x + \ii k_z \dd v_z,\\
    \sigma^2 \dd v_x &= \kappa^2 \dd v_x - \ii \sigma F_r W +
    k_x\sigma Q,\\
  -\ii\sigma\dd v_z &= -\ii k_zQ,\\
\ii \zeta \sigma  Q & = \frac{P}{\rho} \nabla \cdot \bm{\dd v}   -
  \frac{\dd \mathcal{C}}{\rho}. 
\end{align}
The artifical factor $\zeta = 1$  is inserted to keep track of the
left-hand-side of the energy equation. We note that the incompressible
condition used by \cite{jacquet11} is obtained by setting $\zeta$ to zero. 
The linearized dust diffusion
function (Appendix \ref{lin_dust}), 
under the above approximations, is 
\begin{align}
-\frac{\dd \mathcal{C}}{\rho}  = \tstop c_s^2 \left[\ii k_x F_r\left( 1-2\tepsilon\right)
  W + \tepsilon |\bm{k}|^2 Q\right]. 
\end{align}

We eliminate the velocity perturbations to obtain
\begin{align}
  \left(\ii \zeta \sigma - \tstop c_s^2 \tepsilon |\bm{k}|^2\right)Q &=
  \ii \left[
  \frac{P}{\rho}\sigma + k_x\tstop c_s^2 F_r\left(1 -
  2\tepsilon\right)\right]W, \\
   \sigma^2 \left( \kappa^2 - \sigma^2 - \ii k_x F_r\right)W &=
    \left(k_z^2\kappa^2 - \sigma^2|\bm{k}|^2\right)Q, 
\end{align}
which yields the dispersion relation
\begin{align}
  &\frac{\zeta}{c_s^2|\bm{k}|^2}\sigma^5 + \ii \tepsilon \tstop
  \sigma^4 - \left[ \frac{\zeta}{c_s^2|\bm{k}|^2} \left(\kappa^2 - \ii
  k_x F_r\right) + \left(1 - \tepsilon\right)\right]\sigma^3 - \ii
  \tstop \left[\tepsilon \kappa^2 - \ii k_x F_r\left( 1 -
  \tepsilon\right)\right]\sigma^2 \notag\\ 
  &+ \left(1 -
  \tepsilon\right)\left(\frac{k_z\kappa}{|\bm{k}|}\right)^2\sigma +
  k_x \tstop F_r\left(1 - 2\tepsilon\right)
  \left(\frac{k_z\kappa}{|\bm{k}|}\right)^2  = 0.\label{streaming_dispersion}
\end{align}
The equation of state $P = c_s^2\left( 1 - \tepsilon\right)\rho$
was used. If we now set $\zeta = 0$ or consider $c_s^2\to \infty$ to
obtain the 
incompressible limit, and define $\tau_\mathrm{s} \equiv
\tstop/\left(1 - \tepsilon\right)$, we obtain: 
\begin{align*}
\ii \tepsilon \tau_\mathrm{s}
  \sigma^4 - \sigma^3 - 
  \tau_\mathrm{s} \left[ \ii \tepsilon \kappa^2 + k_x F_r\left( 1 -
  \tepsilon\right)\right]\sigma^2 
  + \left(\frac{k_z\kappa}{|\bm{k}|}\right)^2\sigma + 
  k_x \tau_\mathrm{s} F_r\left(1 - 2\tepsilon\right)
  \left(\frac{k_z\kappa}{|\bm{k}|}\right)^2  = 0,
\end{align*}
as derived by \cite{jacquet11} and \cite{laibe14} for the streaming
instability. If $|\sigma|/\OmK = O(\tau_\mathrm{s}\OmK)$ and
$\tau_\mathrm{s}\OmK\ll 1$, then the quartic term
is small and may be neglected. In that case we obtain the cubic
dispersion relation of \citet{youdin05a}. 
